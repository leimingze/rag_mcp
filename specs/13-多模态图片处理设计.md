## 多模态图片处理设计
- 目标： 设计一套完整的图片处理方案，使 RAG 系统能够理解、索引并检索文档中的图片内容，实现"用自然语言搜索图片"的能力，同时保持架构的简洁性与可扩展性。
###  设计理念与策略选型
- 多模态 RAG 的核心挑战在于：如何让纯文本的检索系统"看懂"图片。业界主要有两种技术路线：

| 策略 | 核心思路 | 优势 | 劣势 |
|------|----------|------|------|
| Image-to-Text（图转文） | 利用 Vision LLM 将图片转化为文本描述，复用纯文本 RAG 链路 | 架构统一、实现简单、成本可控 | 描述质量依赖 LLM 能力，可能丢失视觉细节 |
| Multi-Embedding（多模态向量） | 使用 CLIP 等模型将图文统一映射到同一向量空间 | 保留原始视觉特征，支持图搜图 | 需引入额外向量库，架构复杂度高 |
- 本项目采用multi-embedding策略
  - 天然支持：
    - 图 → 图
    - 文 → 图
    - 图 → 文
    - ✅ 对专利 / 工业图 / 外观设计极友好
### 图片处理流程
- 图片处理贯穿 Ingestion Pipeline 的多个阶段，整体流程如下：
```
原始文档 (PDF/PPT/Markdown)
    │
    ▼
┌─────────────────────────────────────────────────────────┐
│  Loader阶段：图片提取与引用收集                           │
│  - 解析文档并提取嵌入图片                                │
│  - 为图片生成唯一 image_id                               │
│  - 插入图片占位符/引用标记                               │
│  - 输出：Document (text + metadata.images[])            │
└─────────────────────────────────────────────────────────┘
    │
    ▼
┌─────────────────────────────────────────────────────────┐
│  Splitter阶段：保持图文关联                               │
│  - 切分时保留图片引用标记                                │
│  - 确保图片与上下文段落关联                               │
│  - 输出：Chunks (含 image_refs)                         │
└─────────────────────────────────────────────────────────┘
    │
    ▼
┌─────────────────────────────────────────────────────────┐
│  Transform阶段：多模态理解与向量化                        │
│  - 多模态模型联合编码图像与上下文                         │
│  - 生成图像语义向量（可选保留轻量描述/标签）               │
│  - 输出：Enriched Chunks (含图像向量与引用)               │
└─────────────────────────────────────────────────────────┘
    │
    ▼
┌─────────────────────────────────────────────────────────┐
│  Storage阶段：双轨存储                                    │
│  - 向量库存储文本向量+图像向量用于检索                    │
│  - 文件系统/Blob存储原始图片                             │
└─────────────────────────────────────────────────────────┘
    │
    ▼
┌─────────────────────────────────────────────────────────┐
│  Retrieval阶段：图文联合检索与返回                        │
│  - 用户Query进入混合检索                                  │
│  - 命中含图片的Chunk与引用                                │
│  - 读取原图并Base64编码                                   │
│  - 返回Text+ImageContent+引用                             │
└─────────────────────────────────────────────────────────┘
```
---

